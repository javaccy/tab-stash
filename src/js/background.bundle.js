!function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return t[o].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var o=chrome,r=(n(3),n(2)),a=n(1),i=o.storage,s=n(17),c=s.bookmark,u={init:function(){this.initStash(),this.bindEvents()},bindEvents:function(){this.optionsEvent(),this.contextMenuEvent(),this.bookmarkModifyEvent()},initStash:function(t){var e=this;o.bookmarks.search({title:c.title},function(n){0===n.length?o.bookmarks.create({title:c.title},function(e){c.id=e.id,i.sync.set({bookmark:c},function(){console.log("set initial bookmarkConfig")}),t&&t()}):(n=n[0],c.id=n.id,i.sync.set({bookmark:c},function(){console.log("set initial bookmarkConfig")}),t&&t()),e.setBadgeText()})},setBadgeText:function(){r.getAll(function(t){chrome.browserAction.setBadgeText({text:t.length+""}),chrome.browserAction.setBadgeBackgroundColor({color:s.badge.color})})},optionsEvent:function(){i.sync.get(null,function(t){a.isEmpty(t)&&i.sync.set(s)})},contextMenuEvent:function(){o.contextMenus.create({title:a.getMsg("extMenuTitle"),contexts:["all"],onclick:function(){r.create()}})},bookmarkModifyEvent:function(){var t=this;a.afterBookmarkModify(function(){t.initStash()})}};u.init()},function(t,e,n){"use strict";var o=chrome,r=o.storage,a=n(4);t.exports={isEmpty:function(t){var e;if(null==t)return!0;switch(e=Object.prototype.toString.call(t).slice(8,-1)){case"String":return!!$.trim(t);case"Array":return!t.length;case"Object":for(var n in t)return!1;return!0;default:return!1}},getMsg:function(t,e){var n=o.i18n.getMessage;return e&&e.length?"StashSummary"==t?n(t,e):void 0:n(t)},getMsgArr:function(t){if(t&&t.length){var e=this,n={};return t.forEach(function(t){t.subSituationArray&&t.subSituationArray.length?n[t.name]=e.getMsg(t.name,t.subSituationArray):n[t.name]=e.getMsg(t.name)}),n}},saveTabToBookmark:function(t,e,n){r.sync.get("bookmark",function(r){o.bookmarks.create({title:t.title,index:t.index,url:t.url,parentId:e},function(e){n&&n(t,e)})})},saveTabListToBookmark:function(t,e,n){var a=this;r.sync.get(null,function(r){console.log("options"),console.log(r),o.bookmarks.create({title:t[e].title,parentId:r.bookmark.id},function(e){for(var i=0;i<t.length;i++)!function(i,s){console.log(r.preserveTab),console.log(i),"blank"===r.preserveTab&&0===i&&(console.log("should create tab"),o.tabs.create({active:!1},null)),a.saveTabToBookmark(t[i],e.id,function(t){i===s-1&&n&&n(),"first"===r.preserveTab&&0===i||"last"===r.preserveTab&&i===s-1||"fixed"===r.preserveTab&&t.pinned||"all"!==r.preserveTab&&o.tabs.remove(t.id)})}(i,t.length)})})},convertBookmarkToStash:function(t){var e=[];return t[0].children?(t[0].children.map(function(t){e.push({title:t.title,id:t.id,dateAddedFull:a(t.dateAdded,"yyyy-mm-dd hh:mm:ss"),dateAddedShort:a(t.dateAdded,"mm-dd"),children:t.children})}),e):e},afterBookmarkModify:function(t){var e=["onCreated","onRemoved","onChanged","onMoved"];e.forEach(function(e){o.bookmarks[e].addListener(function(){t&&t()})})}}},function(t,e,n){"use strict";var o=chrome,r=o.storage,a=n(3),i=n(1);t.exports={create:function(t){a.getAll(function(e,n){i.saveTabListToBookmark(e,n,t)})},getAll:function(t){r.sync.get("bookmark",function(e){o.bookmarks.getSubTree(e.bookmark.id,function(e){t&&t(i.convertBookmarkToStash(e))})})},modify:function(t,e,n){t+="",o.bookmarks.update(t,{title:e},function(t){n&&n(t)})},"delete":function(t,e){t+="",chrome.bookmarks.removeTree(t,function(){e&&e()})}}},function(t,e){"use strict";function n(t){r.windows.getCurrent(function(e){r.tabs.query({windowId:e.id},function(e){for(var n=0,o=e.length;n<o&&!e[n].active;n++);t&&t(e,n)})})}function o(t,e){r.tabs.remove(t,e)}var r=chrome;t.exports={getAll:n,close:o}},function(t,e,n){var o;!function(r){"use strict";function a(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}function i(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var n=new Date(e.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var o=e.getTimezoneOffset()-n.getTimezoneOffset();e.setHours(e.getHours()-o);var r=(e-n)/6048e5;return 1+Math.floor(r)}function s(t){var e=t.getDay();return 0===e&&(e=7),e}function c(t){return null===t?"null":void 0===t?"undefined":"object"!=typeof t?typeof t:Array.isArray(t)?"array":{}.toString.call(t).slice(8,-1).toLowerCase()}var u=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g;return function(o,r,d,l){if(1!==arguments.length||"string"!==c(o)||/\d/.test(o)||(r=o,o=void 0),o=o||new Date,o instanceof Date||(o=new Date(o)),isNaN(o))throw TypeError("Invalid date");r=String(u.masks[r]||r||u.masks["default"]);var m=r.slice(0,4);"UTC:"!==m&&"GMT:"!==m||(r=r.slice(4),d=!0,"GMT:"===m&&(l=!0));var f=d?"getUTC":"get",y=o[f+"Date"](),g=o[f+"Day"](),h=o[f+"Month"](),k=o[f+"FullYear"](),v=o[f+"Hours"](),b=o[f+"Minutes"](),T=o[f+"Seconds"](),M=o[f+"Milliseconds"](),p=d?0:o.getTimezoneOffset(),S=i(o),D=s(o),A={d:y,dd:a(y),ddd:u.i18n.dayNames[g],dddd:u.i18n.dayNames[g+7],m:h+1,mm:a(h+1),mmm:u.i18n.monthNames[h],mmmm:u.i18n.monthNames[h+12],yy:String(k).slice(2),yyyy:k,h:v%12||12,hh:a(v%12||12),H:v,HH:a(v),M:b,MM:a(b),s:T,ss:a(T),l:a(M,3),L:a(Math.round(M/10)),t:v<12?"a":"p",tt:v<12?"am":"pm",T:v<12?"A":"P",TT:v<12?"AM":"PM",Z:l?"GMT":d?"UTC":(String(o).match(e)||[""]).pop().replace(n,""),o:(p>0?"-":"+")+a(100*Math.floor(Math.abs(p)/60)+Math.abs(p)%60,4),S:["th","st","nd","rd"][y%10>3?0:(y%100-y%10!=10)*y%10],W:S,N:D};return r.replace(t,function(t){return t in A?A[t]:t.slice(1,t.length-1)})}}();u.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},u.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},o=function(){return u}.call(e,n,e,t),!(void 0!==o&&(t.exports=o))}(this)},,,,,,,,,,,,,function(t,e){"use strict";t.exports={bookmark:{id:null,title:"tab-stash"},badge:{color:"#398DE3"},preserveTab:"blank"}}]);