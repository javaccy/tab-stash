webpackJsonp([2,0],[function(module,exports,__webpack_require__){"use strict";var c=chrome,stash=(__webpack_require__(3),__webpack_require__(2)),utils=__webpack_require__(1),st=c.storage,conf=__webpack_require__(17),bookmarkConfig=conf.bookmark,background={init:function(){var self=this;self.initOptions(),self.bindEvents()},initOptions:function(){var self=this;st.sync.get(null,function(result){utils.isEmpty(result)?st.sync.set(conf,function(){self.initStash(function(){self.setBadgeText()})}):self.initStash(function(){self.setBadgeText()})})},initStash:function(callback){c.bookmarks.search({title:bookmarkConfig.title},function(bookmark){0===bookmark.length?c.bookmarks.create({title:bookmarkConfig.title},function(result){st.local.set({bookmarkId:result.id},function(){console.log('set initial local storage {bookmarkId: "'+result.id+'"}'),callback&&callback()})}):st.local.set({bookmarkId:bookmark[0].id},function(){console.log('otherwise, reset local storage: {bookmarkId: "'+bookmark[0].id+'"}'),callback&&callback()})})},setBadgeText:function(){stash.getAll(function(list){chrome.browserAction.setBadgeText({text:list.length+""}),chrome.browserAction.setBadgeBackgroundColor({color:conf.badge.color})})},bindEvents:function(){this.contextMenuEvent(),this.bookmarkModifyEvent()},contextMenuEvent:function(){c.contextMenus.create({title:utils.getMsg("extMenuTitle"),contexts:["all"],onclick:function(){stash.create()}})},bookmarkModifyEvent:function(){var self=this;utils.afterBookmarkModify(function(){self.initOptions()})}};background.init()},function(module,exports,__webpack_require__){"use strict";var c=chrome,st=c.storage,dateFormat=__webpack_require__(4);module.exports={debug:function(flag,onFunction,offFunction){flag?onFunction&&onFunction():offFunction&&offFunction()},isEmpty:function(value){var type;if(null==value)return!0;switch(type=Object.prototype.toString.call(value).slice(8,-1)){case"String":return!!$.trim(value);case"Array":return!value.length;case"Object":for(var v in value)return!1;return!0;default:return!1}},getMsg:function(msg,subSituationArray){var translate=c.i18n.getMessage;return subSituationArray&&subSituationArray.length?"StashSummary"==msg?translate(msg,subSituationArray):void 0:translate(msg)},getMsgArr:function(msgArr){if(msgArr&&msgArr.length){var self=this,result={};return msgArr.forEach(function(msg){msg.subSituationArray&&msg.subSituationArray.length?result[msg.name]=self.getMsg(msg.name,msg.subSituationArray):result[msg.name]=self.getMsg(msg.name)}),result}},saveTabToBookmark:function(tab,parentBookmarkId,callback){st.sync.get("bookmark",function(result){c.bookmarks.create({title:tab.title,index:tab.index,url:tab.url,parentId:parentBookmarkId},function(result){callback&&callback(tab,result)})})},saveTabListToBookmark:function(tabList,activeTabIndex,callback){var self=this;st.sync.get(null,function(syncOptions){console.log("syncOptions"),console.log(syncOptions),st.local.get(null,function(localOptions){c.bookmarks.create({title:tabList[activeTabIndex].title,parentId:localOptions.bookmarkId},function(result){for(var i=0;i<tabList.length;i++)!function(index,length){console.log(syncOptions.preserveTab),console.log(index),"blank"===syncOptions.preserveTab&&0===index&&(console.log("should create tab"),c.tabs.create({active:!1},null)),self.saveTabToBookmark(tabList[index],result.id,function(tab){index===length-1&&callback&&callback(),"first"===syncOptions.preserveTab&&0===index||"last"===syncOptions.preserveTab&&index===length-1||"fixed"===syncOptions.preserveTab&&tab.pinned||"all"!==syncOptions.preserveTab&&c.tabs.remove(tab.id)})}(i,tabList.length)})})})},convertBookmarkToStash:function(bookmark){var list=[];return bookmark[0].children?(bookmark[0].children.map(function(item){list.push({title:item.title,id:item.id,dateAddedFull:dateFormat(item.dateAdded,"yyyy-mm-dd hh:mm:ss"),dateAddedShort:dateFormat(item.dateAdded,"mm-dd"),children:item.children})}),list):list},afterBookmarkModify:function(callback){var bookmarkEventArr=["onCreated","onRemoved","onChanged","onMoved"];bookmarkEventArr.forEach(function(event){c.bookmarks[event].addListener(function(){callback&&callback()})})}}},function(module,exports,__webpack_require__){"use strict";var c=chrome,st=c.storage,tab=__webpack_require__(3),utils=__webpack_require__(1);module.exports={create:function(callback){tab.getAll(function(tabs,i){utils.saveTabListToBookmark(tabs,i,callback)})},getAll:function(callback){st.local.get("bookmarkId",function(result){c.bookmarks.getSubTree(result.bookmarkId,function(bookmark){callback&&callback(utils.convertBookmarkToStash(bookmark))})})},modify:function(stashId,title,callback){stashId+="",c.bookmarks.update(stashId,{title:title},function(nodes){callback&&callback(nodes)})},"delete":function(stashId,callback){stashId+="",chrome.bookmarks.removeTree(stashId,function(){callback&&callback()})}}},function(module,exports){"use strict";function getAll(callback){c.windows.getCurrent(function(win){c.tabs.query({windowId:win.id},function(tabs){for(var i=0,len=tabs.length;i<len&&!tabs[i].active;i++);callback&&callback(tabs,i)})})}function close(tabId,callback){c.tabs.remove(tabId,callback)}var c=chrome;module.exports={getAll:getAll,close:close}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!function(global){"use strict";function pad(val,len){for(val=String(val),len=len||2;val.length<len;)val="0"+val;return val}function getWeek(date){var targetThursday=new Date(date.getFullYear(),date.getMonth(),date.getDate());targetThursday.setDate(targetThursday.getDate()-(targetThursday.getDay()+6)%7+3);var firstThursday=new Date(targetThursday.getFullYear(),0,4);firstThursday.setDate(firstThursday.getDate()-(firstThursday.getDay()+6)%7+3);var ds=targetThursday.getTimezoneOffset()-firstThursday.getTimezoneOffset();targetThursday.setHours(targetThursday.getHours()-ds);var weekDiff=(targetThursday-firstThursday)/6048e5;return 1+Math.floor(weekDiff)}function getDayOfWeek(date){var dow=date.getDay();return 0===dow&&(dow=7),dow}function kindOf(val){return null===val?"null":void 0===val?"undefined":"object"!=typeof val?typeof val:Array.isArray(val)?"array":{}.toString.call(val).slice(8,-1).toLowerCase()}var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g;return function(date,mask,utc,gmt){if(1!==arguments.length||"string"!==kindOf(date)||/\d/.test(date)||(mask=date,date=void 0),date=date||new Date,date instanceof Date||(date=new Date(date)),isNaN(date))throw TypeError("Invalid date");mask=String(dateFormat.masks[mask]||mask||dateFormat.masks["default"]);var maskSlice=mask.slice(0,4);"UTC:"!==maskSlice&&"GMT:"!==maskSlice||(mask=mask.slice(4),utc=!0,"GMT:"===maskSlice&&(gmt=!0));var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),W=getWeek(date),N=getDayOfWeek(date),flags={d:d,dd:pad(d),ddd:dateFormat.i18n.dayNames[D],dddd:dateFormat.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dateFormat.i18n.monthNames[m],mmmm:dateFormat.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(Math.round(L/10)),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:gmt?"GMT":utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(100*Math.floor(Math.abs(o)/60)+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10],W:W,N:N};return mask.replace(token,function(match){return match in flags?flags[match]:match.slice(1,match.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},__WEBPACK_AMD_DEFINE_RESULT__=function(){return dateFormat}.call(exports,__webpack_require__,exports,module),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(this)},,,,,,,,,,,,,function(module,exports){"use strict";module.exports={bookmark:{title:"tab-stash"},badge:{color:"#398DE3"},preserveTab:"blank"}}]);